<html>
<head>
<title>Crash Rates (Telemetry)</title>
<style>

body {
  font-family: sans-serif;
}

table {
  border-collapse: collapse;
  border-spacing: 0 0;
  border: 1px solid black;
}

td {
  border: 1px solid black;
  padding: 0.1em 0.33em;
}

td.type-float {
  text-align: right;
}

thead {
  font-weight: bold;
}
</style>
</head>
<body>
<h1>Stability Dashboard</h1>
<h3>Firefox Desktop</h3>
<table id="data-table">
  <thead><tr></tr></thead>
  <tbody></tbody>
</table>
<script>
var xhr = new XMLHttpRequest();
xhr.addEventListener("load", function() {

  let data = undefined;
  try {
    data  = JSON.parse(this.responseText).query_result.data;
  } catch (e) {
    console.error("Failed a JSON parse");
    console.error(e.message);
  }

  let table = document.getElementById("data-table");
  let theadRow = table.getElementsByTagName("tr")[0];

  data.columns.forEach((column) => {
    let el = document.createElement("td");
    el.textContent = column.friendly_name;
    theadRow.appendChild(el);
  });

  let tbody = table.getElementsByTagName("tbody")[0];
  data.rows.sort((rowA, rowB) => {
    if (rowA.activity_date + rowA.channel < rowB.activity_date + rowB.channel) {
      return -1;
    } else if (rowA.activity_date + rowA.channel > rowB.activity_date + rowB.channel) {
      return 1;
    } else {
      return 0;
    }
  }).forEach((row) => {
    if (!['nightly', 'aurora', 'beta', 'release'].includes(row.channel)) {
      return;
    }
    let tr = document.createElement("tr");
    data.columns.forEach((column) => {
      let td = document.createElement("td");
      td.className = "type-" + column.type;
      let value = row[column.name];
      // If a number and has decimals, format it
      if (column.type === "float" && value % 1 > 0) {
        td.textContent = Number(value).toFixed(2);
      } else {
        td.textContent = value;
      }
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  });

});
xhr.addEventListener("error", () => {
  console.error("ERROR");
});
xhr.open("GET", "https://sql.telemetry.mozilla.org/api/queries/1092/results.json?api_key=f7dac61893e040ca59c76fd616f082479e2a1c85");
xhr.send();
</script>
</body>
</html>
